"use strict";var h=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var s in t)h(e,s,{get:t[s],enumerable:!0})},T=(e,t,s,m)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of x(t))!f.call(e,o)&&o!==s&&h(e,o,{get:()=>t[o],enumerable:!(m=l(t,o))||m.enumerable});return e};var b=e=>T(h({},"__esModule",{value:!0}),e);var R={};Q(R,{graphql:()=>C});module.exports=b(R);var n=async(e,t,s)=>{t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{};let o=s??(r=>typeof r=="object"&&r&&"data"in r?r.data:r),c=await globalThis.fetch(e,t).then(async r=>{let i=r.headers.get("Content-Type")?.toLowerCase();if(i?.startsWith("application/json")){let a=await r.json();if(!r.ok)throw a;return a}if(i?.startsWith("text/html")||i?.startsWith("text/plain")){let a=await r.text();if(!r.ok)throw a;return a}}).catch(r=>{throw r});return o(c)};var u=e=>{let t={};if(Array.isArray(e.fields)&&e.fields.length>0){let s=(m,o=[])=>{if(typeof m=="object"){let c=[];for(let r in m){let i=m[r]??[];if(Array.isArray(i))for(let a of i)c.push(s(a,[...o,r]));else if(typeof i=="object")for(let a of Object.keys(i)){let y=i[a];for(let S of y)c.push(s(S,[...o,`${r}:${a}`]))}}return c.flatMap(r=>r)}return[...o,String(m)].join(".")};t.fields=e.fields.flatMap(m=>s(m)).join(",")}return e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(",")),t};var d="/",j=(e,t)=>(e.endsWith(d)&&(e=e.slice(0,-1)),t.startsWith(d)||(t=d+t),e+t),p=(e,t,s)=>{let m=e.pathname===d?t:j(e.pathname,t),o=new globalThis.URL(m,e);if(s)for(let[c,r]of Object.entries(u(s)))if(r&&typeof r=="object"&&!Array.isArray(r))for(let[i,a]of Object.entries(r))o.searchParams.set(`${c}[${i}]`,String(a));else o.searchParams.set(c,r);return o};var C=()=>e=>({async query(t,s,m="items"){let o={method:"POST",body:JSON.stringify({query:t,variables:s})},c={};if("getToken"in this){let a=await this.getToken();a&&(c.Authorization=`Bearer ${a}`)}"Content-Type"in c||(c["Content-Type"]="application/json"),o.headers=c;let r=m==="items"?"/graphql":"/graphql/system",i=p(e.url,r);return await n(i.toString(),o)}});0&&(module.exports={graphql});
//# sourceMappingURL=index.cjs.map